{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://linz.github.io/stac/_STAC_VERSION_/historical_imagery/schema.json",
  "title": "Historical Imagery STAC Extension",
  "description": "Historical Imagery STAC Extension for Items and Collections",
  "allOf": [
    {
      "$ref": "https://linz.github.io/stac/_STAC_VERSION_/aerial-photo/schema.json#"
    },
    {
      "$ref": "https://linz.github.io/stac/_STAC_VERSION_/camera/schema.json#"
    },
    {
      "$ref": "https://linz.github.io/stac/_STAC_VERSION_/film/schema.json#"
    },
    {
      "$ref": "https://linz.github.io/stac/_STAC_VERSION_/scanning/schema.json#"
    },
    {
      "$ref": "https://stac-extensions.github.io/file/v2.0.0/schema.json#"
    },
    {
      "$ref": "https://stac-extensions.github.io/eo/v1.0.0/schema.json#"
    },
    {
      "$ref": "https://stac-extensions.github.io/projection/v1.0.0/schema.json#"
    },
    {
      "$ref": "#/definitions/fields"
    },
    {
      "$ref": "#/definitions/stac_extensions"
    },
    {
      "$comment": "Type-specific schemas",
      "oneOf": [
        {
          "$comment": "This is the schema for STAC Items.",
          "allOf": [
            {
              "type": "object",
              "required": ["type", "geometry", "bbox", "properties", "assets"],
              "properties": {
                "type": {
                  "const": "Feature"
                },
                "properties": {
                  "allOf": [
                    {
                      "$comment": "Require fields here for Item Properties.",

                      "required": ["type", "datetime", "platform", "mission"]
                    },
                    {
                      "$ref": "https://schemas.stacspec.org/v1.0.0/item-spec/json-schema/item.json#"
                    },
                    {
                      "$ref": "#/definitions/stac_extensions"
                    },
                    {
                      "$ref": "#/definitions/fields"
                    }
                  ]
                },
                "assets": {
                  "$comment": "This validates the fields in Item Assets, but does not require them.",
                  "type": "object",
                  "additionalProperties": {
                    "$ref": "#/definitions/fields"
                  }
                }
              }
            }
          ]
        },
        {
          "$comment": "This is the schema for STAC Collections.",
          "type": "object",
          "allOf": [
            {
              "required": ["type"],
              "properties": {
                "type": {
                  "const": "Collection"
                }
              }
            },
            {
              "$ref": "https://schemas.stacspec.org/v1.0.0/collection-spec/json-schema/collection.json#"
            },
            {
              "$ref": "#/definitions/stac_extensions"
            }
          ],
          "anyOf": [
            {
              "$comment": "This is the schema for the top-level fields in a Collection. Remove this if this extension does not define top-level fields for Collections.",
              "allOf": [
                {
                  "$comment": "Require fields here for Collections (top-level).",
                  "required": ["id", "title"]
                },
                {
                  "$ref": "#/definitions/fields"
                }
              ]
            },
            {
              "$comment": "This validates the fields in Collection Assets, but does not require them.",
              "required": ["assets"],
              "properties": {
                "assets": {
                  "type": "object",
                  "not": {
                    "additionalProperties": {
                      "not": {
                        "allOf": [
                          {
                            "$ref": "#/definitions/require_any_field"
                          },
                          {
                            "$ref": "#/definitions/fields"
                          }
                        ]
                      }
                    }
                  }
                }
              }
            },
            {
              "$comment": "This is the schema for the fields in Item Asset Definitions. It doesn't require any fields.",
              "required": ["item_assets"],
              "properties": {
                "item_assets": {
                  "type": "object",
                  "not": {
                    "additionalProperties": {
                      "not": {
                        "allOf": [
                          {
                            "$ref": "#/definitions/require_any_field"
                          },
                          {
                            "$ref": "#/definitions/fields"
                          }
                        ]
                      }
                    }
                  }
                }
              }
            },
            {
              "$comment": "This is the schema for the fields in Summaries. By default, only checks the existence of the properties, but not the schema of the summaries.",
              "required": ["summaries"],
              "properties": {
                "summaries": {
                  "$ref": "#/definitions/require_any_field"
                }
              }
            }
          ]
        }
      ]
    }
  ],

  "definitions": {
    "stac_extensions": {
      "type": "object",
      "required": ["stac_extensions"],
      "properties": {
        "stac_extensions": {
          "type": "array",
          "allOf": [
            {
              "contains": {
                "const": "https://linz.github.io/stac/_STAC_VERSION_/historical-imagery/schema.json"
              }
            }
          ]
        }
      }
    },

    "require_any_field": {
      "$comment": "Please list all fields here so that we can force the existence of one of them in other parts of the schemas.",
      "anyOf": [
        { "required": ["platform"] },
        { "required": ["instruments"] },
        { "required": ["aerial-photo:run"] },
        { "required": ["aerial-photo:anomalies"] },
        { "required": ["aerial-photo:sequence_number"] },
        { "required": ["film:id"] },
        { "required": ["film:physical_condition"] },
        { "required": ["film:physical_size"] },
        { "required": ["eo:bands"] },
        { "required": ["scan:is_original"] },
        { "required": ["scan:scanned"] },
        { "required": ["proj:centroid"] },
        { "required": ["proj:epsg"] },
        { "required": ["camera:sequence_number"] },
        { "required": ["camera:nominal_focal_length"] },
        { "required": ["film:negative_sequence"] }
      ]
    },
    "fields": {
      "$comment": "Add your new fields here. Don't require them here, do that above in the corresponding schema.",
      "type": "object",
      "properties": {
        "title": {
          "type": "string",
          "minLength": 1
        },
        "summaries": {
          "type": "object",
          "required": [
            "platform",
            "instruments",
            "aerial-photo:run",
            "aerial-photo:anomalies",
            "film:id",
            "film:physical_condition",
            "film:physical_size",
            "scan:is_original",
            "eo:bands",
            "scan:scanned",
            "proj:centroid",
            "proj:epsg",
            "aerial-photo:sequence_number",
            "camera:sequence_number",
            "camera:nominal_focal_length",
            "film:negative_sequence"
          ],
          "properties": {
            "platform": {
              "type": "array",
              "items": {
                "type": "string",
                "minLength": 1,
                "minItems": 1
              }
            },
            "instrument": {
              "type": "array",
              "items": {
                "type": "string",
                "minLength": 1,
                "minItems": 1
              }
            },
            "mission": {
              "type": "array",
              "items": {
                "type": "string",
                "minLength": 1,
                "minItems": 1
              }
            },
            "aerial-photo:run": {
              "type": "array",
              "items": {
                "type": "string",
                "minLength": 1,
                "minItems": 1
              }
            },
            "aerial-photo:anomalies": {
              "type": "array",
              "items": {
                "type": "string",
                "minLength": 1,
                "minItems": 1
              }
            },
            "film:id": {
              "type": "array",
              "items": {
                "type": "string",
                "minLength": 1,
                "minItems": 1
              }
            },
            "film:physical_condition": {
              "type": "array",
              "items": {
                "type": "string",
                "minLength": 1,
                "minItems": 1
              }
            },
            "film:physical_size": {
              "type": "array",
              "items": {
                "type": "string",
                "minLength": 1,
                "minItems": 1
              }
            },
            "scan:is_original": {
              "type": "array",
              "items": {
                "type": "boolean"
              }
            },
            "eo:bands": {
              "title": "Bands",
              "type": "array",
              "minItems": 1,
              "items": {
                "title": "Band",
                "type": "object",
                "minProperties": 1,
                "properties": {
                  "name": {
                    "title": "Name of the band",
                    "type": "string"
                  },
                  "common_name": {
                    "title": "Common Name of the band",
                    "type": "string",
                    "enum": [
                      "coastal",
                      "blue",
                      "green",
                      "red",
                      "rededge",
                      "yellow",
                      "pan",
                      "nir",
                      "nir08",
                      "nir09",
                      "cirrus",
                      "swir16",
                      "swir22",
                      "lwir",
                      "lwir11",
                      "lwir12"
                    ]
                  }
                }
              }
            },
            "scan:scanned": {
              "type": "object",
              "required": ["interval"],
              "title": "scanned dates",
              "properties": {
                "interval": {
                  "title": "Scanned Date range",
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "title": "Scanned Date range",
                    "type": "array",
                    "minItems": 2,
                    "maxItems": 2,
                    "items": {
                      "type": ["string", "null"],
                      "format": "date-time",
                      "pattern": "(\\+00:00|Z)$"
                    }
                  }
                },
                "proj:centroid": {
                  "type": "object",
                  "required": ["lat", "lon"],
                  "properties": {
                    "lat": {
                      "type": "number",
                      "minimum": -90,
                      "maximum": 90
                    },
                    "lon": {
                      "type": "number",
                      "minimum": -180,
                      "maximum": 180
                    }
                  }
                }
              },
              "proj:epsg": {
                "type": "object",
                "required": ["minimum", "maximum"],
                "properties": {
                  "minimum": {
                    "title": "EPSG code",
                    "type": "integer"
                  },
                  "maximum": {
                    "title": "EPSG code",
                    "type": "integer"
                  }
                }
              },
              "aerial-photo:altitude": {
                "type": "object",
                "required": ["minimum", "maximum"],
                "properties": {
                  "minimum": {
                    "title": "Lowest altitude",
                    "type": "integer"
                  },
                  "maximum": {
                    "title": "Highest altitude",
                    "type": "integer"
                  }
                }
              },
              "aerial-photo:scale": {
                "type": "object",
                "required": ["minimum", "maximum"],
                "properties": {
                  "minimum": {
                    "title": "Minimum scale",
                    "type": "integer"
                  },
                  "maximum": {
                    "title": "Maximum scale",
                    "type": "integer"
                  }
                }
              },
              "aerial-photo:sequence_number": {
                "type": "object",
                "required": ["minimum", "maximum"],
                "properties": {
                  "minimum": {
                    "title": "Lowest sequence number",
                    "type": "integer"
                  },
                  "maximum": {
                    "title": "highest sequence number",
                    "type": "integer"
                  }
                }
              },
              "camera:sequence_number": {
                "type": "object",
                "required": ["minimum", "maximum"],
                "properties": {
                  "minimum": {
                    "title": "Lowest sequence number",
                    "type": "integer"
                  },
                  "maximum": {
                    "title": "highest sequence number",
                    "type": "integer"
                  }
                }
              },
              "camera:nominal_focal_length": {
                "type": "object",
                "required": ["minimum", "maximum"],
                "properties": {
                  "minimum": {
                    "title": "Lowest nominal focal length",
                    "type": "integer"
                  },
                  "maximum": {
                    "title": "highest nominal focal length",
                    "type": "integer"
                  }
                }
              },
              "film:negative_sequence": {
                "type": "object",
                "required": ["minimum", "maximum"],
                "properties": {
                  "minimum": {
                    "title": "Lowest negative sequence number",
                    "type": "integer"
                  },
                  "maximum": {
                    "title": "highest negative sequence number",
                    "type": "integer"
                  }
                }
              }
            }
          }
        }
      },
      "patternProperties": {
        "^(?!historical-imagery:)": {}
      },
      "additionalProperties": false
    }
  }
}
